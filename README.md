# Support session project from [HBV501](https://github.com/siggigauti/Video-leiga-support-session) turned into a RESTful API

## RESTful APIs

Endpoints should ideally represent collections and instances. (Tables and entries)

```json
{
    movies: {
        GET: /movies,
        POST: /movies,
        GET_ONE: /movies/{id},
        DELETE: /movies/{id},
        PUT: /movies/{id},
    },
    users: {
        GET: /users,
        POST: /users,
        GET_ONE: /users/{id},
    }
}
```

### Status codes

+ **2XX** represents a successful request.
+ **4XX** represents a client error.
+ **5XX** represents a server error.

### GET requests

+ Return **200 *OK*** on success.
+ Return **404 *NOT FOUND*** on failure, include an error message.

### POST requests

+ Usually return a **201 *CREATED*** on success. Response body should include the object that was created or nothing.
+ Return **400 *BAD REQUEST*** on failure, include an error message.

### PUT/PATCH requests

+ Return **200 *OK*** on success. Response body should include the object that was updated or nothing.
+ Return **404 *NOT FOUND*** if item to be updated is not found.
+ Return **400 *BAD REQUEST*** on failure.

### DELETE requests

+ Return **204 *NOT CONTENT*** on success.
+ Return **404 *NOT FOUND*** if item to be deleted is not found.

## What to consider when changing methods

1. Change the class annotation into `@RestController`
2. The model object is useless to a RestController.
3. What you were adding to the model is what you want to return. You have to consider if what you were adding is useful, e.g. the user entity could be placed there to access it in JSP but won't necessarily be useful in a RestController.
4. Status codes should matter. They are a tool to tell the client if a request was successful or not.
5. Consider wether the error messages you send from the server should be displayed client-side. In which case they have to be more descriptive.

---

+ `@RequestBody` is used when receiving raw json data.
+ `@ModelAttribute` can be used together with a RequestWrapper to receive multipart/form-data (a file).

## Simple implementation

The [Simple controller](src/main/java/is/hi/hbv501/videoleiga/videoleiga/Controllers/SimpleController.java) is setup to return only the data on success, and is what we mainly covered in the code along. It handles errors by throwing a *ResponseStatusException*.

This does not focus on the "correct" on success status codes, but always returns an error status code on failure.

## Wrapper implementation

The [Home controller](src/main/java/is/hi/hbv501/videoleiga/videoleiga/Controllers/HomeController.java) uses a uniform structure for every response. Helpful when you are returning more then a single entity in a response.

Request wrappers can be useful when the request body includes 2 or more separate entities:

```json
// JSON object example
{
    "movie": {
        ...
    },
    "user": {
        ...
    }
}
```

```java
// Corresponding java object
public class RequestWrapper {
    private Movie movie;
    private User user;
    ...
}
```

## Breaking the Jackson recursion error

If you have bi-directional relationships you might run into a problem with recursion within the response body generated by the Jackson library.

To break that recursion we have to tell Jackson to ignore certain things when it creates the response.

```java
public class User {
    ...
    @JsonIgnoreProperties("user") // Ignore the user entity within the RentalLog
    private List<RentalLog> rentals;
    ...
}

public class RentalLog {
    ...
    @JsonIgnoreProperties("rentals") // Ignore the rentals entity within the User
    private User user;
    ...
}
```

## Hiding the password in the response

We generally never want to send the password to the client in the response.

```java
public class User {
    ...
    @JsonProperty(access = JsonProperty.Access.WRITE_ONLY)
    public String getPassword(){
        return password;
    }
}
```
